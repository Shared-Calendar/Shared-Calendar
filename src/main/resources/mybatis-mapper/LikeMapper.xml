<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="study.sharedcalendar.mapper.LikeMapper">
    <insert id="createLike">
        INSERT INTO HEART( user_id
                         , shared_schedule_id
                         , is_like
                         , created_at
                         , updated_at)
        VALUES ( #{userId}
               , #{sharedScheduleId}
               , 1
               , NOW()
               , NOW());
    </insert>

    <select id="likeExist" resultType="boolean">
        SELECT EXISTS(
                       SELECT *
                       FROM HEART
                       WHERE user_id = #{userId}
                         AND shared_schedule_id = #{sharedScheduleId}
                   );
    </select>

    <update id="updateLike">
        UPDATE HEART
        SET is_like = 1
        WHERE user_id = #{userId}
          AND shared_schedule_id = #{sharedScheduleId};
    </update>

    <update id="incrementLike">
        UPDATE SHARED_SCHEDULE
        SET like_count = like_count + 1
        WHERE id = #{sharedScheduleId};
    </update>

    <select id="isLike" resultType="boolean">
        SELECT is_like
        FROM HEART
        WHERE user_id = #{userId}
          AND shared_schedule_id = #{sharedScheduleId};
    </select>

    <update id="updateUnlike">
        UPDATE HEART
        SET is_like = 0
        WHERE user_id = #{userId}
          AND shared_schedule_id = #{sharedScheduleId};
    </update>

    <update id="decrementLike">
        UPDATE SHARED_SCHEDULE
        SET like_count = like_count - 1
        WHERE id = #{sharedScheduleId};
    </update>

</mapper>